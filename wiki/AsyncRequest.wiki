#summary How to make async requests with rupy.
#labels Phase-Implementation

{{{
public static class Async extends Service {
	public String path() { return "/async"; }
	public void filter(Event event) throws Event, Exception {
		if(event.push()) {
			Output out = event.output();
			out.print(event.query().string("done"));
			// call this when you are completely done
			// event.output().finish();
			out.flush();
		}
		else {
			event.hold();
			new Thread(new Runnable() {
				public void run() {
					try {
						while(true) {
							// Do something slow in a separate thread.
							event.query().put("done", "data to send back");
							event.reply().wakeup();
						}
					}
					catch(Exception e) {
						e.printStackTrace();
					}
				}
			}).start();

			event.output().println("<pre>Slow request!");
			event.output().flush();
		}
	}
}
}}}