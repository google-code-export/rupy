#summary How to stream chunks asynchronously.

You can now stream messages over HTTP via rupy.

The performance ranges from 0% 3770S(4), 80-120% D510MO(2) to 99% RPi(1). Output is req x2 for one, two and three but x3 for four; so total throughput:
           
  3770S ~13.000 event/s (~4.000 req/s).
  D510MO ~9.000 event/s (~3.000 req/s).
  RPi ~1.000 event/s (~300 req/s).

This code allows you to receive dynamic chunks with Flash from rupy.

To use it download [http://rupy.googlecode.com/files/talk-0.9.1.zip talk].

{{{
package {
    import flash.errors.*;
    import flash.events.*;
    import flash.net.URLRequest;
    import flash.net.URLStream;

    public class Comet {
        private var stream:URLStream;
        private var offset:int = 0;

        /*
         * Call /ping?name=XXX here.
         */
        public function Comet(url:String) {
            stream = new URLStream();
            var request:URLRequest = new URLRequest(url);
            stream.addEventListener(ProgressEvent.PROGRESS, progressHandler);
            try {
                stream.load(request);
            } catch (error:Error) {
                trace("Unable to load requested URL.");
            }
        }

        private function progressHandler(event:Event):void {
            var progress:ProgressEvent = ProgressEvent(event);
            var message:String = stream.readUTFBytes(progress.bytesLoaded - offset);
            offset = progress.bytesLoaded;
            trace(message);
        }
    }
}
}}}